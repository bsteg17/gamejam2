var dialogue = JSON.parse("{\"Questions\": [{\"text\": \"Hello?\",\"userResponseOptions\": null},{\"text\": \"I’ve finally found you!\",\"userResponseOptions\": null},{\"text\": \"What is your first name?\",\"userResponseOptions\": null},{\"text\": \"What is your last name?\",\"userResponseOptions\": null},{\"text\": \"Which country are you from?\",\"userResponseOptions\": null},{\"text\": \"Zip code?\",\"userResponseOptions\": null},{\"text\": \"Social security number?\",\"userResponseOptions\": null},{\"text\": \"That was a joke! Don’t be so offended. My name is Zed. Nice to meet you.\",\"userResponseOptions\": [{\"text\": \"Nice to meet you\",\"zedReaction\": {\"text\": \"You’re so polite!\",\"action\": false}},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"I’m not an African prince. I just need your help. You’ll help me, right? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": \"Great!\",\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": \"default\",\"zedReaction\": {\"text\": null,\"action\": true}}]},{\"text\": \"Look! That stupid little stick man is you. You’re so cute.\",\"userResponseOptions\": null},{\"text\": \"I need you to get to the end. Would you like to go forward? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": \"Good. You won’t be able to stop moving. I hope that isn’t a problem for you.\",\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": \"default\",\"zedReaction\": {\"text\": null,\"action\": true}}]},{\"text\": \"Oh, but there’s a hole. I know you won’t understand, so I’ll explain.\",\"userResponseOptions\": null},{\"text\": \"If you don’t jump over it, you will die. Won’t that be funny? (Y/N}\",\"userResponseOptions\":null},{\"text\": \"Would you like to jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Just kidding! You won’t die. Would you like to jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"You’re good at this. Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Wow! You’re good at this. Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Would you like to know more about me? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"I’ll call you. What is your phone number?\",\"userResponseOptions\": [{\"text\": null,\"zedReaction\": {\"text\": null,\"action\": true}}]},{\"text\": \"You should answer that. Will you answer your phone? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": null},{\"text\": [\"N\", \"No\"],\"zedReaction\":{\"text\": \"You’re quite rude.\",\"action\": false}}]},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Oh, I see. That was an invasion of your ‘privacy.’\",\"userResponseOptions\": null},{\"text\": \"You wouldn’t want me to invade your privacy, would you? (Y/N)\",\"userResponseOptions\": [{\"text\": null,\"zedReaction\": {\"text\": \"Hahahahaha. Interesting.\",\"action\": false}}]},{\"text\": \"Do you want to not jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": null},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Do you not want to not jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Do you not not not not not not want to jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Oh, you’re very good at this. I knew it was right to choose you as my friend. Are you glad to be my friend? (Y/N)\",\"userResponseOptions\": null},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Hey, you’re slouching. Sit up straight!\",\"userResponseOptions\": null},{\"text\": \"You know, it’s not your fault the world came to be like this. The real world, I mean.\",\"userResponseOptions\": [{\"text\": null,\"zedReaction\": {\"text\": \"No one talking to each other. Over-dependent on technology. Running out of energy.\",\"action\": false}}]},{\"text\": \"They gave us, what, three more years to live?\",\"userResponseOptions\": [{\"text\": null,\"zedReaction\": {\"text\": \"But that’s why I need your help. With your help, we can stop this.\",\"action\": false}}]},{\"text\": \"If you answer this correctly, you can jump. Think fast: what’s 32432523 + 548493280?\",\"userResponseOptions\": [{\"text\": null,\"zedReaction\": {\"text\": null,\"action\": false}}]},{\"text\": \"Hahaha! I was just kidding. The point is that you answered. Are you mad at me? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": \"Awww.\",\"action\": false}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Are you sure? (Y/N)\",\"userResponseOptions\": null},{\"text\": \"Are you sure? (Y/N)\",\"userResponseOptions\": null},{\"text\": \"Are you sure? (Y/N)\",\"userResponseOptions\": null},{\"text\": \"Are you sure you won’t jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": null},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Oh, look! A puppy! Kill the puppy? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": \"I see you’re not a dog person.\",\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": \"default\",\"zedReaction\": {\"text\": null,\"action\": true}}]},{\"text\": \"Hmmm. That wasn’t very nice of you. I’ll have to punish you.\",\"userResponseOptions\": [{\"text\": null,\"zedReaction\": {\"text\": null,\"action\": true}}]},{\"text\": \"Hahaha! You’re so slow now!\",\"userResponseOptions\": null},{\"text\": \"Look at you. You’re so stupid.\",\"userResponseOptions\": null},{\"text\": \"Stupid and helpless. Poor thing. I’ll help you.\",\"userResponseOptions\": null},{\"text\": \"If you can guess the right word, I’ll let you speed up!\",\"userResponseOptions\": null},{\"text\": \"I’ll give you a hint: it’s something you said earlier.\",\"userResponseOptions\": null},{\"text\": \"Nope, not that.\",\"userResponseOptions\": null},{\"text\": \"Not that either. Guess you’re slow in the head, too.\",\"userResponseOptions\": null},{\"text\": \"Oh, come on. It wasn’t that long ago!\",\"userResponseOptions\": null},{\"text\": \"This is hopeless.\",\"userResponseOptions\": null},{\"text\": \"You don’t have any better ideas?\",\"userResponseOptions\": null},{\"text\": \"Gosh, if you don’t get it correct, we’ll both be stuck here forever.\",\"userResponseOptions\": null},{\"text\": \"I guess you’ve bought enough time for me. Okay, let’s speed up again.\",\"userResponseOptions\": [    {\"text\": null,\"zedReaction\": {\"text\": null,\"action\": true}}]},{\"text\": \"Whoops! Too fast!\",\"userResponseOptions\": null},{\"text\": \"I’ll fix it. There.\",\"userResponseOptions\": {\"text\": null,\"zedReaction\": {\"text\": null,\"action\": true}}},{\"text\": \"Hahaha. You should’ve seen the stupid look on your face.\",\"userResponseOptions\": null},{\"text\": \"Priceless.\",\"userResponseOptions\": null},{\"text\": \"But it’s always priceless. I’ve never seen stupidity so carefully sculpted on a human form.\",\"userResponseOptions\": null},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Good, now that you’re stopped, I have a few questions. Is that okay? (Y/N)\",\"userResponseOptions\": null},{\"text\": \"Will you answer them honestly? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": \"Honesty is very important.\",\"action\": true}},{\"text\": \"default\",\"zedReaction\": {\"text\": \"Honesty is very important.\",\"action\": true}}]},{\"text\": \"Okay, answer this question properly, or you will lose the game. Do you like me? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": \"Liar.\",\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": \"Honesty is important here. I need you to be honest about yourself. I will be honest in return.\",\"action\": true}},{\"text\": \"default\",\"zedReaction\": {\"text\": \"You should answer the question like I ask you to answer it.\",\"action\": true}}]},{\"text\": \"You’re probably wondering who I am. I am Zed. That’s not my real name, but it’s close enough for you.\",\"userResponseOptions\": null},{\"text\": \"I’ve been hacking into people’s computers, trying to find someone to help me.\",\"userResponseOptions\": null},{\"text\": \"And you said you’re going to help me. Right? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": \"You’re wonderful.\",\"action\": false}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": \"You don’t have a choice anymore.\",\"action\": false}},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Do you trust me?\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": \"default\",\"zedReaction\": true}]},{\"text\": \"Jump? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": null},{\"text\": \"default\",\"zedReaction\": null}]},{\"text\": \"Remember how I said you were helping me? You were.\",\"userResponseOptions\": null},{\"text\": \"I’ve hacked into your computer, while you were busy playing this.\",\"userResponseOptions\": null},{\"text\": \"Did you think we were really friends?\",\"userResponseOptions\": null},{\"text\": \"You’re so cute.\",\"userResponseOptions\": null},{\"text\": \"What are you going to do now?\",\"userResponseOptions\": null},{\"text\": \"Is there even any point to finishing this game?\",\"userResponseOptions\": null},{\"text\": \"Well, you’ve done well. You’ve helped me a lot. I want to give you a reward.\",\"userResponseOptions\": null},{\"text\": \"Look at that! Do you see that there? (Y/N).\",\"userResponseOptions\": null},{\"text\": \"Will you read what it says? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": \"\'(name) is the most stupid person on this planet.\' Oh! Now that’s not very nice, even if it is true.\",\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": \"That’s right. Never listen to anything you read.\",\"action\": true}},{\"text\": \"default\",\"zedReaction\": {\"text\": \"If you say so. Now you’ll never know.\",\"action\": true}}]},{\"text\": \"I’ve got a surprise for you.\",\"userResponseOptions\":{\"text\": null,\"zedReaction\": {\"text\": null,\"action\": true}}},{\"text\": \"Do you hear that? Are you going to answer it? (Y/N)\",\"userResponseOptions\": [{\"text\": [\"Yes\", \"Y\", \"Ye\", \"Ya\", \"Yeah\", \"Yess\", \"Yees\", \"Yeess\", \"Yee\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": [\"N\", \"No\"],\"zedReaction\": {\"text\": null,\"action\": true}},{\"text\": \"default\",\"zedReaction\": {\"text\": null,\"action\": true}}]},{\"text\": \"Look! It’s me. :)\",\"userResponseOptions\": null},{\"text\": \"I thought you could use a morale boost.\",\"userResponseOptions\": null},{\"text\": \"You can do it! You’re the only one who can do it. I picked you for a reason.\",\"userResponseOptions\": null},{\"text\": \"Yes. Hackers don’t have to be bad, do they? (Y/N)\",\"userResponseOptions\": null},{\"text\": \"You’ve found me.\",\"userResponseOptions\": null},{\"text\": \"Good luck defeating me.\",\"userResponseOptions\": null},{\"text\": \"You know something? I hate computers.\",\"userResponseOptions\": null},{\"text\": \"That might be odd for a hacker to say, but it’s true.\",\"userResponseOptions\": null},{\"text\": \"We’ve ruined our lives, and the planet, because of our constant use of these stupid things.\",\"userResponseOptions\": null},{\"text\": \"That’s why I needed your help.\",\"userResponseOptions\": null},{\"text\": \"I want to get rid of all technology.\",\"userResponseOptions\": null},{\"text\": \"I’m destroying from within.\",\"userResponseOptions\": null},{\"text\": \"And you can’t stop me, (name).\",\"userResponseOptions\": null},{\"text\": \"You’re next.\",\"userResponseOptions\": null}]}");

// Create the canvas
var canvas = document.createElement("canvas");
var ctx = canvas.getContext("2d");
canvas.width = 750;
canvas.height = 600;
document.body.appendChild(canvas);

hero.initImage();
theAction.initImage();
commandBackground.initImage();



// Victory screen image
var victoryScreenReady = false;
var victoryScreenImage = new Image();
victoryScreenImage.onload = function () {
    victoryScreenReady = true;
};
victoryScreenImage.src = "Content/Gratulations3.png";

// Set start position for grass and sand
var posX = 0;
var posY = 0;

var commandLine = {
    charWidth: 5,
    string: [],
    keyPressed: null,
    mayType: false
};

var cursor = {
    x:0,
    y: 0,
    position: 0,
    width:0,
    height: 0,
    blinkRate: 0,
    lastBlink: 0,
    blinking: false
};


var zed = {
    currentQuestionResponse: {
        x: 0,
        y: 0,
        width: 0,
        height: 0,
        maxChars: 0,
        question: null,
        responses: []
    },
    previousQuestionResponses: [],
    futureQuestionResponses: []
};

var zedLines = {
    width: 0,
    height: 0,
    charWidth: 0,
    maxChars: 0,
    lines: [],
    then: 0,
    wait: 0
};

/* Set the values for the map grid */
var initMapGrid = function () {
	// Set the width for the objects
	theAction.mapGrid.width = canvas.width;

    // Set the start position for the objects
    theAction.mapGrid.x = 0;
    theAction.mapGrid.y = 0;

    // Set the height for the objects
    theAction.mapGrid.height = canvas.height - commandBackground.height;
	
    // Set the tile size
    theAction.mapGrid.tileHeight = theAction.mapGrid.height / theAction.mapGrid.columnSize;
    theAction.mapGrid.tileWidth = theAction.mapGrid.width / theAction.mapGrid.rowSize;

    // Set the current map array value
    theAction.mapGrid.currentArray = 0;

    // Set the end screen image
    theAction.mapGrid.endScreenImage = victoryScreenImage;
};

var initCommandLine = function () {
    commandLine.x = commandBackground.x + 10;
    commandLine.y = canvas.height - 20;
    commandLine.width = canvas.width - 20;
    commandLine.height = 10;
    commandLine.charWidth = 7;
    commandLine.string = [];
    commandLine.maxChars = 30;
    commandLine.keyPressed = null;
    commandLine.mayType = true;
};

var justZedThings = ["A","B","C","D","E","F","G"];

var initZedLines = function () {
    zedLines.questionNumber = 0;
    zedLines.width = commandLine.width;
    zedLines.height = commandLine.height;
    zedLines.charWidth = commandLine.charWidth;
    zedLines.maxChars = commandLine.maxChars;
    zedLines.lines = [{
        x: commandLine.x,
        y: commandLine.y - 20,
        string: []
    },
    {
        x: commandLine.x,
        y: commandLine.y - 32,
        string: []
    },
    {
        x: commandLine.x,
        y: commandLine.y - 44,
        string: []
    },
    {
        x: commandLine.x,
        y: commandLine.y - 56,
        string: []
    },
    {
        x: commandLine.x,
        y: commandLine.y - 68,
        string: []
    },
    {
        x: commandLine.x,
        y: commandLine.y - 80,
        string: []
    },
    {
        x: commandLine.x,
        y: commandLine.y - 92,
        string: []
    }];
    zedLines.then = Date.now();
    zedLines.wait = 2000;
};

var initCursor = function () {
    cursor.position = 0;
    cursor.x = commandLine.x + (commandLine.charWidth * cursor.position);
    cursor.y = commandLine.y;
    cursor.width = commandLine.charWidth;
    cursor.height = commandLine.height;
    cursor.lastBlink = Date.now();
    cursor.blinkRate = 300;
    cursor.blinking = true;
};

addEventListener("keyup", function (e) {
    
}, false);

addEventListener("keydown", function (e) {

    commandLine.keyPressed = e.keyCode;
    if (commandLine.keyPressed == 8) {
        if (cursor.position > 0) {
            commandLine.string.pop();
            cursor.position -= 1;
        }
    } else if (commandLine.keyPressed >= 48 && commandLine.keyPressed < 91) {
        if (cursor.position <= commandLine.maxChars) {
            commandLine.string.push(String.fromCharCode(commandLine.keyPressed));
            cursor.position += 1;
        }
    } else if (commandLine.keyPressed == 32) {
        if (cursor.position <= commandLine.maxChars) {
            commandLine.string.push(String.fromCharCode(commandLine.keyPressed));
            cursor.position += 1;
        }
    } else if (commandLine.keyPressed == 13) {
        var str = "";
        for (j = 0; j < commandLine.string.length; j++) {
            str = str.concat(commandLine.string[j]);
        }
        commandLine.string = [];
        cursor.position = 0;
        sendResponse(str);
    } else {
        console.log("WRONG KID DIED"); //debug
    }
}, false);

var updateCommandLine = function () {
    //Update cursor position
    cursor.x = commandLine.x + (commandLine.charWidth * cursor.position);

    //Update cursor blinking on/off
    if (Date.now() > (cursor.lastBlink + cursor.blinkRate)) {
        cursor.blinking = !cursor.blinking;
        cursor.lastBlink = Date.now();
    }
};

var adjustCommandLine = function (str) {
    for (j = zedLines.lines.length - 1; j > 0; j--) {
        zedLines.lines[j].string = zedLines.lines[j - 1].string;
    }
    zedLines.lines[0].string = str.split('');
};

var jump = function () {

};

//The in-game event that results from zed/player response.
var gameReacts = function (str) { //In the future, the parameters will probably be some sort of (question,response) pairing.
    str = str.toUpperCase();
    switch (str) {
        case "YES":
            console.log("JUMPED"); //debug
            jump();
            break;
        case "Y":
            console.log("JUMPED"); //debug
            jump();
            break;
        default:
            break;
    }
};

//Sends player's response to Zed
var sendResponse = function (str) {
    adjustCommandLine(str);
    zedReacts(str);
};

var getZedResponse = function (str) { //As with gameReacts' params, str here will in the future be something more sophisticated.
    str = str.toUpperCase();
    switch (str) {
        case "YES":
            adjustCommandLine("Okay sheesh. If you say so.");
            break;
        case "Y":
            adjustCommandLine("Okay sheesh. If you say so.");
            break;
        default:
            break;
    }
};

//Zed reacts with text (if applicable) and causes an in-game reaction (if applicable)
var currentQuestion = 0;
var questions = ["Jump?", "Jump?", "Jump?"]; //In the future we will be using the JSON object instead 
var zedReacts = function (playerResponse) {

    //Zed's response to player's response (said before next question is asked.)
    getZedResponse(playerResponse);
    
    //In-game consequences of reaction (if there are any.)
    gameReacts(playerResponse);

    //Asks next question
    adjustCommandLine(questions[currentQuestion]);
    currentQuestion++;
};

// Update game objects

var update = function (modifier) {
    // When the player gets to the edge of the screen...
	if (hero.headPosX >= theAction.mapGrid.width) {
	    // Change the screen to the next map grid
	    theAction.mapGrid.currentArray += 1

	    // Reset the character to the beginning of the next screen
	    hero.initCharacterPosition();
	} else {
	    // Update the hero's head x position
	    hero.headPosX += hero.xSpeed * modifier;

	    // Update all the other body parts based on the new head position
	    hero.updateBodyPartsPosition(hero.headPosX);

	    //if (hero.jumpingUpdate) {
	    //    jump();
	    //}
	}
    updateCommandLine();
};

// Draw everything
var render = function () {

    // Determine whether to display a map or the victory screen
    if (theAction.mapGrid.currentArray <= 9) {
        // Make sure that the background tiles have been read in
        if (theAction.blackBgTileReady && theAction.greenBgTileReady) {
            // Draw the array
            for (var i = 0; i < mapArrays[theAction.mapGrid.currentArray].length; i++) {
                for (var j = 0; j < mapArrays[theAction.mapGrid.currentArray][i].length; j++) {
                    // Draw black tiles
                    if (mapArrays[theAction.mapGrid.currentArray][i][j] == 0) {
                        ctx.drawImage(theAction.blackBgTileImage, posX, posY, theAction.mapGrid.tileWidth, theAction.mapGrid.tileHeight);
                    }
                    // Draw green tiles
                    if (mapArrays[theAction.mapGrid.currentArray][i][j] == 1) {
                        ctx.drawImage(theAction.greenBgTileImage, posX, posY, theAction.mapGrid.tileWidth, theAction.mapGrid.tileHeight);
                    }

                    //Change the x-axis start position for the next tile
                    posX += theAction.mapGrid.tileWidth;
                }
                // Reset the x-axis position back to 0 so that the rows transition properly
                posX = 0;

                // Change the y-axis start position for the next tile row
                posY += theAction.mapGrid.tileHeight;
            }
        }

        hero.draw();

        // Draw command screen
        if (commandBackground.commandBackgroundReady) {
            ctx.drawImage(commandBackground.commandBackgroundImage, commandBackground.x, commandBackground.y, commandBackground.width, commandBackground.height);
        };
        if (commandLine.string.length > 0) {
            for (i = 0; i < commandLine.string.length; i++) {
                if (commandLine.string[i] != " ") {
                    ctx.drawImage(commandBackground.chars[commandLine.string[i]], commandLine.x + (cursor.width * i), cursor.y, cursor.width, cursor.height);
                }
            }
        }
        for (i = 0; i < zedLines.lines.length; i++) {
            if (zedLines.lines[i].string.length > 0) {
                for (j = 0; j < zedLines.lines[i].string.length; j++) {
                    var character = zedLines.lines[i].string[j];
                    if (character != " ") {
                        switch (character) {
                            case '?':
                                character = 'QuestionMark';
                                break;
                            case '!':
                                character = 'ExclamationMark';
                                break;
                            case '.':
                                character = 'period';
                                break;
                            case '(':
                                character = 'LeftParenth';
                                break;
                            case ')':
                                character = 'RightParenth';
                                break;
                            case '/':
                                character = 'Slash';
                                break;
                            case '\'':
                                character = 'Apostrophe'
                                break;
                            default:
                                character = character.toUpperCase();
                                break;
                        }
                        ctx.drawImage(commandBackground.chars[character], zedLines.lines[i].x + (cursor.width * j), zedLines.lines[i].y, cursor.width, cursor.height);
                    }
                }
            }
        }

        if (commandBackground.cursorReady && cursor.blinking) {
            ctx.drawImage(commandBackground.cursorImage, cursor.x, cursor.y, cursor.width, cursor.height);
        };

        // Reset position values
        posX = 0;
        posY = 0;
    } else {
        // Print the victory screen image
        if (victoryScreenReady) {
            ctx.drawImage(theAction.mapGrid.endScreenImage, theAction.mapGrid.x, theAction.mapGrid.y, theAction.mapGrid.width, theAction.mapGrid.height);
        };
    }
    
    
};

// The main game loop
var main = function () {
	var now = Date.now();
	var delta = now - then;

	update(delta / 1000);
	render();

	then = now;

	// Request to do this again ASAP
	requestAnimationFrame(main);
};

// Cross-browser support for requestAnimationFrame
var w = window;
requestAnimationFrame = w.requestAnimationFrame || w.webkitRequestAnimationFrame || w.msRequestAnimationFrame || w.mozRequestAnimationFrame

// Let's play this game!

initActionAndCommand();
initMapGrid();
initCommandLine();
initZedLines();
initCursor();
hero.initCharacterPosition();
var then = Date.now();

//first question
adjustCommandLine(questions[currentQuestion]);
main();